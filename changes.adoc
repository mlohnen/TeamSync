
# Changes

## 20200414

* werkt al goed

## 20200507

- nieuwe parameters in teamsync.ini : maakklassenteams, maaklesgroepenteams, maakvakkenteams
- rare voorwaarde docenten klas > "4" verwijderd
- nieuwe filters voor excl_klas, excl_docent
- betere detectie voor actieve teams, actieve docenten
- schermuitvoer verfraaid
- variabele 'vaktotaal' hernoemd naar 'ruwegroepen'

## 20200621

* Herschreven en opgesplitst in drie modules (ophalen, transformeren, wegschrijven) in twee afzonderlijke scripts:
** `Ophalen-MagisterData.ps1`: ophalen
** `Transformeren-Naar-SchoolDataSync.ps1`: transformeren, wegschrijven
* Progressiebalken lagere updatefrequentie,
* Uitvoerlijsten worden gesorteerd.
* Dubbele docenten in teams worden voorkomen.
* Bestandsnaam van INI-file kan op commandoregel worden gespecifieerd met parameter -inifile <filename>, bij verstek 'teamsync.ini'. 
* datamappen kunnen worden gespecificeerd in Ini-bestand

## 20200623
* Pad naar leerling.csv ontbrak
* Scriptnaam in venstertitel
* Volledige vakomschrijving toegevoegd aan teamnaam
* Alle schermuitvoer wordt gelogd.

## 20200629 
* Vakomschrijvingen worden gekapitaliseerd. 
* Vakomschrijvingen toegevoegd aan teamnaam waar dit herkend wordt in lesgroep of klas-vak-groep.
* Mogelijkheid voor insluitend filteren op locatie toegevoegd
* Ondersteuning voor gevallen waar Magister login afwijkend is van Microsoft 365 / Azure AD identiteit. Als schakelaar UseEmail=1, dan wordt voor docenten het veld "Id" gevuld uit het overeenkomstig AD-userobject attribuut UserPrincipalName in Active Directory, door AD user-attribuut employeeId te matchen aan Magister stamnummer. Als schakelaar UseEmail=1, dan wordt voor leerlingen het Magister email-veld gebruikt voor de Id. 

## 20200701 
* toegevoegd: insluitend filter voor leerlingen op basis van locatie (Magister veld 'Administratieveeenheid.Omschrijving')
* useemail=1 : docenten zonder overeenkomstig emailadres worden eruit gefilterd. 

## 20200701a
* fout hersteld: Section SIS ID werd gevuld met teamnaam, niet teamID

## 20200702
* fout hersteld: `personeelemail.clixml` werd opgeslagen in '.\data_temp\' in plaats van datakladmap.

## 20200704
* ongebruikte variabelen en functies opgeruimd

## 20200804
* vermijd 'divide by zero' in progressiebalk als er 0 aftelbare items zijn. 

## 20200817
* (Ophalen-Magisterdata.ps1) skip leerlingen met lege id

## 20200828
* (Ophalen-Magisterdata.ps1) onderdelen geherstructureerd

* (Ophalen-Magisterdata.ps1) configvariable "handhaafJPTMedewerkerCodeIsLogin"
toegevoegd. Gebruik `handhaafJPTMedewerkerCodeIsLogin=1`. Bij verstek geldt
`handhaafJPTMedewerkerCodeIsLogin=0` . Deze instelling dient om uitsluitend
medewerkers te verwerken waarbij Magister->Code gelijk is aan
Magister->loginaccount.naam. Dit wordt in een speciaal geval voor JPT gedaan om
dubbele identiteiten weg te filteren. 

* bugfix: In sommige gevallen werden teveel medewerkers afgekeurd voor verdere
verwerking wanneer code of loginaccount.name niet gelijk of ingevuld waren.
Config `handhaafJPTMedewerkerCodeIsLogin=0` verhelpt dat. 

## 20200109 
* wijziging: excl_docent en incl_docent filters filteren niet op Code, maar op Id. 
* wijziging: duidelijkere logging, maakt geen gebruik van PowerShell transcripts, maar dupliceert alleen consoleuitvoer naar log. 
* documentatie over regex uitgebreid met escape karakter, link naar documentatie, voorbeeld.

## 20200902
* wijziging: (Ophalen-Magisterdata.ps1) altijd docenten zonder id uitfilteren

## 20200902b
* wijziging: configvariabelen 'teamid_prefix' en 'teamnaam_suffix' toegevoegd
* (Transformeren-Naar-SchoolDataSync.ps1) geoptimaliseerd : ~~25% snelheidswinst
* Exceptions worden ook gelogd naar het logbestand

## 20201127
* Preciezere definitie van methoden voor het koppelen van identiteiten. Configuratievariabelen:
** `leerling_id = login`
** `leerling_id = email`
** `medewerker_id = login`
** `medewerker_id = code`
** `medewerker_id = csv_upn`
* Verouderde parameters : `useemail`, `ADsearchscope`, `ADserver` . Opzoeken van UserPrincipalName in Active Directory wordt *niet* meer ondersteund! Gebruik hiervoor in de plaats een CSV-opzoektabel. 
* resultaat 1 bij fout.
* configvariabelen gecreeerd in globale scope.
* schonere uitvoer en voortgang.
* beknoptere foutmeldingen.
* fout in documentatie hersteld omtrent configuratiebestand-parameter. Aliassen toegevoegd.
* Herindeling Ophalen-MagisterData.ps1.

## TO DO

* SDS V2 format 
* parameter viewonly toont resultaat.

